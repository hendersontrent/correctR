<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="correctR">
<title>Introduction to correctR • correctR</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to correctR">
<meta property="og:description" content="correctR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">correctR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/correctR.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hendersontrent/correctR/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Introduction to correctR</h1>
                        <h4 data-toc-skip class="author">Trent
Henderson</h4>
            
            <h4 data-toc-skip class="date">2022-12-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/hendersontrent/correctR/blob/HEAD/vignettes/correctR.Rmd" class="external-link"><code>vignettes/correctR.Rmd</code></a></small>
      <div class="d-none name"><code>correctR.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hendersontrent.github.io/correctR/">correctR</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>correctR</code> is a lightweight package that implements a
small number of corrected test statistics for cases when samples of two
machine learning model metrics (e.g., classification accuracy) are not
independent (and therefore are correlated), such as in the case of
resampling and <span class="math inline">\(k\)</span>-fold
cross-validation. We demonstrate the basic functionality here using some
trivial examples for the following corrected tests that are currently
implemented in <code>correctR</code>:</p>
<ul>
<li>Random subsampling</li>
<li>
<span class="math inline">\(k\)</span>-fold cross-validation</li>
<li>Repeated <span class="math inline">\(k\)</span>-fold
cross-validation</li>
</ul>
<p>These corrections were all originally proposed by Nadeau and Bengio
(2003)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Nadeau, C., and Bengio, Y. Inference for the
Generalization Error. Machine Learning, 52, 239-281, (2003).&lt;/p&gt;"><sup>1</sup></a>
with additional representations in Bouckaert and Frank (2004)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Bouckaert, R. R., and Frank, E. Evaluating the
Replicability of Significance Tests for Comparing Learning Algorithms.
Advances in Knowledge Discovery and Data Mining. PAKDD 2004. Lecture
Notes in Computer Science, 3056, (2004).&lt;/p&gt;"><sup>2</sup></a>.</p>
<div class="section level3">
<h3 id="random-subsampling-correction">Random subsampling correction<a class="anchor" aria-label="anchor" href="#random-subsampling-correction"></a>
</h3>
<p>In random subsampling, the standard <span class="math inline">\(t\)</span>-test inflates Type I error when used in
conjunction with random subsampling due to an underestimation of the
variance, as found by Dietterich (1998)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Dietterich, T. G. (1998). Approximate Statistical Tests
for Comparing Supervised Classification Learning Algorithms. Neural
Computation, 10(7)&lt;/p&gt;"><sup>3</sup></a>. Nadeau and Bengio
(2003) proposed a solution (which we implement as
<code>resampled_ttest</code> in <code>correctR</code>) in the form
of:</p>
<p><span class="math display">\[
t = \frac{\frac{1}{n} \sum_{j=1}^{n}x_{j}}{\sqrt{(\frac{1}{n} +
\frac{n_{2}}{n_{1}})\sigma^{2}}}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the number of
resamples (NOTE: <span class="math inline">\(n\)</span> is <em>not</em>
sample size), <span class="math inline">\(n_{1}\)</span> is the number
of samples in the training data, and <span class="math inline">\(n_{2}\)</span> is the number of samples in the
test data. <span class="math inline">\(\sigma^{2}\)</span> is the
variance estimate used in the standard paired <span class="math inline">\(t\)</span>-test (which simply has <span class="math inline">\(\frac{\sigma}{\sqrt{n}}\)</span> in the
denominator where <span class="math inline">\(n\)</span> is the sample
size in this case).</p>
</div>
<div class="section level3">
<h3 id="k-fold-cross-validation-correction">k-fold cross-validation correction<a class="anchor" aria-label="anchor" href="#k-fold-cross-validation-correction"></a>
</h3>
<p>There is an alternate formulation of the random subsampling
correction, devised in terms of the unbiased estimator <span class="math inline">\(\rho\)</span>, discussed in Corani et al. (2016)<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Corani, G., Benavoli, A., Demsar, J., Mangili, F., and
Zaffalon, M. Statistical comparison of classifiers through Bayesian
hierarchical modelling. Machine Learning, 106, (2017).&lt;/p&gt;"><sup>4</sup></a> which we
implement as <code>kfold_tttest</code> in <code>correctR</code>:</p>
<p><span class="math display">\[
t = \frac{\frac{1}{n} \sum_{j=1}^{n}x_{j}}{\sqrt{(\frac{1}{n} +
\frac{\rho}{1-\rho})\sigma^{2}}}
\]</span></p>
<p>where <span class="math inline">\(n\)</span> is the number of
resamples and <span class="math inline">\(\rho = \frac{1}{k}\)</span>
where <span class="math inline">\(k\)</span> is the number of folds in
the <span class="math inline">\(k\)</span>-fold cross-validation
procedure. This formulation stems from the fact that Nadeau and Bengio
(2003) proved there is no unbiased estimator, but it can be approximated
with <span class="math inline">\(\rho = \frac{1}{k}\)</span>.</p>
</div>
<div class="section level3">
<h3 id="repeated-k-fold-cross-validation-correction">Repeated k-fold cross-validation correction<a class="anchor" aria-label="anchor" href="#repeated-k-fold-cross-validation-correction"></a>
</h3>
<p>Repeated <span class="math inline">\(k\)</span>-fold cross-validation
is more complex than the previous case(s) as we now have <span class="math inline">\(r\)</span> repeats for every fold <span class="math inline">\(k\)</span>. Bouckaert and Frank (2004) present a
nice representation of the corrected test for this case which we
implement as <code>repkfold_ttest</code> in <code>correctR</code>:</p>
<p><span class="math display">\[
t = \frac{\frac{1}{k \cdot r} \sum_{i=1}^{k} \sum_{j=1}^{r}
x_{ij}}{\sqrt{(\frac{1}{k \cdot r} + \frac{n_{2}}{n_{1}})\sigma^{2}}}
\]</span></p>
</div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>In the real world, we would have proper results obtained through
fitting two models according to one or more of the procedures outlined
above. For simplicity here, we are just going to simulate three datasets
so we can get to the package functionality cleaner and easier. We are
going to assume we are in a classification context and generate
classification accuracy values. These values are purposefully
egregious—we are going to (in the case of the random subsampling) just
fix the train set sample size (<code>n1</code>) to 80 and the test set
sample size (<code>n2</code>) to 20, and assume (using the same data)
for the <span class="math inline">\(k\)</span>-fold cross-validation
correction that the same numbers were obtained on such a method. Again,
the values are not important here, it is the corrections we are going to
apply next that are crucial.</p>
<p>In the case of repeated <span class="math inline">\(k\)</span>-fold
cross-validation, take note of the column names. While your
<code>data.frame</code> you pass in to <code>repkfold_ttest</code> can
have more than the four columns specified here, it <strong>must</strong>
contain at least these four with the exact corresponding names. The
function explicitly searches for them. They are:</p>
<ol style="list-style-type: decimal">
<li>
<code>"model"</code> — contains a label for each of the two models
to compare</li>
<li>
<code>"values"</code> — the numerical values of the performance
metric (i.e., classification accuracy)</li>
<li>
<code>"k"</code> — which fold the values correspond to</li>
<li>
<code>"r"</code> — which repeat of the fold the values correspond
to</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span> <span class="co"># For reproducibility</span></span>
<span></span>
<span><span class="co"># Data for random subsampling and k-fold cross-validation corrections</span></span>
<span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">0.6</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">30</span>, mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Data for repeated k-fold cross-validation correction</span></span>
<span></span>
<span><span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>model <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">60</span><span class="op">)</span>,</span>
<span>                  values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>, mean <span class="op">=</span> <span class="fl">0.6</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>, </span>
<span>                             <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">60</span>, mean <span class="op">=</span> <span class="fl">0.4</span>, sd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                  k <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">15</span><span class="op">)</span>,</span>
<span>                  r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span>, times <span class="op">=</span> <span class="fl">30</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="package-functionality">Package functionality<a class="anchor" aria-label="anchor" href="#package-functionality"></a>
</h2>
<p>We can fit all the corrections in one-line functions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rss</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/resampled_ttest.html">resampled_ttest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, n <span class="op">=</span> <span class="fl">30</span>, n1 <span class="op">=</span> <span class="fl">80</span>, n2 <span class="op">=</span> <span class="fl">20</span><span class="op">)</span> <span class="co"># Random subsampling</span></span>
<span><span class="va">kcv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/kfold_ttest.html">kfold_ttest</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, n <span class="op">=</span> <span class="fl">100</span>, k <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="co"># k-fold cross-validation</span></span>
<span><span class="va">rkcv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/repkfold_ttest.html">repkfold_ttest</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">tmp</span>, n1 <span class="op">=</span> <span class="fl">80</span>, n2 <span class="op">=</span> <span class="fl">20</span>, k <span class="op">=</span> <span class="fl">2</span>, r <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="co"># Repeated k-fold cross-validation</span></span></code></pre></div>
<p>All the functions return a <code>data.frame</code> with two named
columns: <code>"statistic"</code> (the <span class="math inline">\(t\)</span>-statistic) and <code>"p.value"</code>
(the associated <span class="math inline">\(p\)</span>-value), meaning
they can be easily integrated into complex machine pipelines. Here is an
example for <code>resampled.t.test</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rss</span><span class="op">)</span></span>
<span><span class="co">##   statistic    p.value</span></span>
<span><span class="co">## 1  2.407318 0.01132991</span></span></code></pre></div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Trent Henderson.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
